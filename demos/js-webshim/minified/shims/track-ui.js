(function(e){if(Modernizr.track&&Modernizr.texttrackapi&&document.addEventListener){var t=webshims.cfg.track,i=function(t){e(t.target).filter("track").each(n)},a=webshims.bugs.track,n=function(){return a||!t.override&&3==e.prop(this,"readyState")?(t.override=!0,webshims.reTest("track"),document.removeEventListener("error",i,!0),this&&e.nodeName(this,"track")?webshims.error("track support was overwritten. Please check your vtt including your vtt mime-type"):webshims.info("track support was overwritten. due to bad browser support"),!1):void 0},r=function(){document.addEventListener("error",i,!0),a?n():e("track").each(n)};t.override||r()}})(jQuery),webshims.register("track-ui",function(e,t){"use strict";function i(e,t){var i=!0,a=0,n=e.length;if(n!=t.length)i=!1;else for(;n>a;a++)if(e[a]!=t[a]){i=!1;break}return i}var a=t.cfg.track,n={subtitles:1,captions:1,descriptions:1},r=t.mediaelement,o=function(){return!a.override&&Modernizr.track},s={update:function(a,n){a.activeCues.length?i(a.displayedActiveCues,a.activeCues)||(a.displayedActiveCues=a.activeCues,a.trackDisplay||(a.trackDisplay=e('<div class="cue-display"><span class="description-cues" aria-live="assertive" /></div>').insertAfter(n),this.addEvents(a,n),t.docObserve()),a.hasDirtyTrackDisplay&&n.triggerHandler("forceupdatetrackdisplay"),this.showCues(a)):this.hide(a)},showCues:function(t){var i=e('<span class="cue-wrapper" />');e.each(t.displayedActiveCues,function(a,n){var r=n.id?'id="cue-id-'+n.id+'"':"",o=e('<span class="cue-line"><span '+r+' class="cue" /></span>').find("span").html(n.getCueAsHTML()).end();"descriptions"==n.track.kind?setTimeout(function(){e("span.description-cues",t.trackDisplay).html(o)},0):i.prepend(o)}),e("span.cue-wrapper",t.trackDisplay).remove(),t.trackDisplay.append(i)},addEvents:function(e,t){if(a.positionDisplay){var i,n=function(i){if(e.displayedActiveCues.length||i===!0){e.trackDisplay.css({display:"none"});var a=t.getShadowElement();a.offsetParent();var n=a.innerHeight(),r=a.innerWidth(),o=a.position();e.trackDisplay.css({left:o.left,width:r,height:n-45,top:o.top,display:"block"}),e.trackDisplay.css("fontSize",Math.max(Math.round(n/30),7)),e.hasDirtyTrackDisplay=!1}else e.hasDirtyTrackDisplay=!0},r=function(){clearTimeout(i),i=setTimeout(n,0)},o=function(){n(!0)};t.on("playerdimensionchange mediaelementapichange updatetrackdisplay updatemediaelementdimensions swfstageresize",r),t.on("forceupdatetrackdisplay",o).onWSOff("updateshadowdom",r),o()}},hide:function(t){t.trackDisplay&&t.displayedActiveCues.length&&(t.displayedActiveCues=[],e("span.cue-wrapper",t.trackDisplay).remove(),e("span.description-cues",t.trackDisplay).empty())}};if(e.extend(e.event.customEvent,{updatetrackdisplay:!0,forceupdatetrackdisplay:!0}),r.trackDisplay=s,!r.createCueList){var l={getCueById:function(e){for(var t=null,i=0,a=this.length;a>i;i++)if(this[i].id===e){t=this[i];break}return t}};r.createCueList=function(){return e.extend([],l)}}r.getActiveCue=function(t,i,o,s){t._lastFoundCue||(t._lastFoundCue={index:0,time:0}),!Modernizr.track||a.override||t._shimActiveCues||(t._shimActiveCues=r.createCueList());for(var l,u,c=0;t.shimActiveCues.length>c;c++)u=t.shimActiveCues[c],u.startTime>o||o>u.endTime?(t.shimActiveCues.splice(c,1),c--,u.pauseOnExit&&e(i).pause(),e(t).triggerHandler("cuechange"),e(u).triggerHandler("exit")):"showing"==t.mode&&n[t.kind]&&-1==e.inArray(u,s.activeCues)&&s.activeCues.push(u);for(l=t.cues.length,c=o>t._lastFoundCue.time?t._lastFoundCue.index:0;l>c&&(u=t.cues[c],o>=u.startTime&&u.endTime>=o&&-1==e.inArray(u,t.shimActiveCues)&&(t.shimActiveCues.push(u),"showing"==t.mode&&n[t.kind]&&s.activeCues.push(u),e(t).triggerHandler("cuechange"),e(u).triggerHandler("enter"),t._lastFoundCue.time=o,t._lastFoundCue.index=c),!(u.startTime>o));c++);},o()&&function(){var i,a=function(t){setTimeout(function(){i=!0,e(t).triggerHandler("updatetrackdisplay"),i=!1},9)},n=function(n,r,s){var l,u="_sup"+s,c={prop:{}};c.prop[s]=function(){return!i&&o()&&a(e(this).closest("audio, video")),l.prop[u].apply(this,arguments)},l=t.defineNodeNameProperty(n,r,c)};n("track","track","get"),["audio","video"].forEach(function(e){n(e,"textTracks","get"),n("nodeName","addTextTrack","value")})}(),t.addReady(function(i,a){e("video, audio",i).add(a.filter("video, audio")).filter(function(){return t.implement(this,"trackui")}).each(function(){var i,a,n,l=e(this),u=function(){var e,n;if(a&&i||(a=l.prop("textTracks"),i=t.data(l[0],"mediaelementBase")||t.data(l[0],"mediaelementBase",{}),i.displayedActiveCues||(i.displayedActiveCues=[])),a&&(n=l.prop("currentTime"),n||0===n)){i.activeCues=[];for(var o=0,u=a.length;u>o;o++)e=a[o],"disabled"!=e.mode&&e.cues&&e.cues.length&&r.getActiveCue(e,l,n,i);s.update(i,l)}},c=function(e){clearTimeout(n),e&&"timeupdate"==e.type?(u(),setTimeout(c,90)):n=setTimeout(u,9)},d=function(){l.off(".trackview").on("play.trackview timeupdate.trackview updatetrackdisplay.trackview",c)};l.on("remove",function(e){!e.originalEvent&&i&&i.trackDisplay&&i.trackDisplay.remove()}),o()?l.on("mediaelementapichange trackapichange",function(){!o()||l.is(".nonnative-api-active")?d():(a=l.prop("textTracks"),i=t.data(l[0],"mediaelementBase")||t.data(l[0],"mediaelementBase",{}),e.each(a,function(e,t){t._shimActiveCues&&delete t._shimActiveCues}),s.hide(i),l.unbind(".trackview"))}):d()})})});