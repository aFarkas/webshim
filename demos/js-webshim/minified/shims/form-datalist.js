jQuery.webshims.ready("dom-support forms",function(b,c,n,h,j){c.propTypes.element=function(g){c.createPropDefault(g,"attr");if(!g.prop)g.prop={get:function(){var c=g.attr.get.call(this);c&&(c=b("#"+c)[0])&&g.propNodeName&&!b.nodeName(c,g.propNodeName)&&(c=null);return c||null},writeable:!1}};(function(){if(!Modernizr.datalist){var g=0,o={submit:1,button:1,reset:1,hidden:1,range:1,date:1},l=b.browser.msie&&parseInt(b.browser.version,10)<7,k={},m=function(a){if(!a)return[];if(k[a])return k[a];var b;
c.ready("json-storage",function(){try{b=JSON.parse(localStorage.getItem("storedDatalistOptions"+a))}catch(d){}k[a]=b||[]});return b||[]},p={_create:function(a){if(!o[(a.input.getAttribute("type")||"").toLowerCase()||a.input.type]){var f=a.datalist,d=b.data(a.input,"datalistWidget");if(f&&d&&d.datalist!==f)d.datalist=f,d.id=a.id,d._resetListCached();else if(f){if(!(d&&d.datalist===f)){g++;var e=this;this.timedHide=function(){clearTimeout(e.hideTimer);e.hideTimer=setTimeout(b.proxy(e,"hideList"),9)};
this.datalist=f;this.id=a.id;this.hasViewableData=!0;this._autocomplete=b.attr(a.input,"autocomplete");b.data(a.input,"datalistWidget",this);this.shadowList=b('<div class="datalist-polyfill" />').appendTo("body");this.index=-1;this.input=a.input;this.arrayOptions=[];this.shadowList.delegate("li","mouseover.datalistWidget mousedown.datalistWidget click.datalistWidget",function(a){var d=b("li:not(.hidden-item)",e.shadowList),f=a.type=="mousedown"||a.type=="click";e.markItem(d.index(a.target),f,d);a.type==
"click"&&e.hideList();return a.type!="mousedown"}).bind("focusout",this.timedHide);a.input.setAttribute("autocomplete","off");b(a.input).attr({"aria-haspopup":"true"}).bind("input.datalistWidget",b.proxy(this,"showHideOptions")).bind("keydown.datalistWidget",function(a){var d=a.keyCode;if(d==40&&!e.showList())return e.markItem(e.index+1,!0),!1;if(e.isListVisible){if(d==38)return e.markItem(e.index-1,!0),!1;if(!a.shiftKey&&(d==33||d==36))return e.markItem(0,!0),!1;if(!a.shiftKey&&(d==34||d==35))return a=
b("li:not(.hidden-item)",e.shadowList),e.markItem(a.length-1,!0,a),!1;if(d==13||d==27)return d==13&&(a=b("li.active-item:not(.hidden-item)",e.shadowList),a[0]&&(b.prop(e.input,"value",a.attr("data-value")),b(e.input).triggerHandler("updateInput"))),e.hideList(),!1}}).bind("focus.datalistWidget",function(){b(this).hasClass("list-focus")&&e.showList()}).bind("blur.datalistWidget",this.timedHide);b(this.datalist).unbind("updateDatalist.datalistWidget").bind("updateDatalist.datalistWidget",b.proxy(this,
"_resetListCached"));this._resetListCached();a.input.form&&a.input.id&&b(a.input.form).bind("submit.datalistWidget"+a.input.id,function(){var d=b.prop(a.input,"value");e.storedOptions=m(a.input.name||a.input.id);if(d&&e.storedOptions.indexOf(d)==-1){e.storedOptions.push(d);var d=a.input.name||a.input.id,f=e.storedOptions;if(d){f=f||[];try{localStorage.setItem("storedDatalistOptions"+d,JSON.stringify(f))}catch(c){}}}});b(n).bind("unload",function(){e.destroy()})}}else d&&d.destroy()}},destroy:function(){var a=
b.attr(this.input,"autocomplete");b(this.input).unbind(".datalistWidget").removeData("datalistWidget");this.shadowList.remove();b(h).unbind(".datalist"+this.id);this.input.form&&this.input.id&&b(this.input.form).unbind("submit.datalistWidget"+this.input.id);this.input.removeAttribute("aria-haspopup");a===j?this.input.removeAttribute("autocomplete"):b(this.input).attr("autocomplete",a)},_resetListCached:function(a){var b=this;this.needsUpdate=!0;this.lastUpdatedValue=!1;this.lastUnfoundValue="";if(!this.updateTimer)this.updateTimer=
setTimeout(function(){b.updateListOptions(a&&h.activeElement==b.input);b=null},0)},updateListOptions:function(a){this.needsUpdate=!1;clearTimeout(this.updateTimer);this.updateTimer=!1;this.shadowList.css({fontSize:b.curCSS(this.input,"fontSize"),fontFamily:b.curCSS(this.input,"fontFamily")});for(var f=[],d=[],e=[],c,g=b("option",this.datalist),i=0,h=b("option",this.datalist).length;i<h;i++){c=g[i];if(c.disabled)return;c={value:b(c).val()||"",text:b.trim(b.attr(c,"label")||c.textContent||c.innerText||
b.text([c])||""),className:c.className||"",style:b.attr(c,"style")||""};if(!c.text)c.text=c.value;d[i]=c.value;e[i]=c}this.storedOptions=m(this.input.name||this.input.id);this.storedOptions.forEach(function(a){d.indexOf(a)==-1&&e.push({value:a,text:a,className:"",style:""})});e.forEach(function(a,b){var d=a.value.indexOf('"')!=-1?"'"+a.value+"'":'"'+a.value+'"';f[b]="<li data-value="+d+' class="'+a.className+'" style="'+a.style+'" tabindex="-1" role="listitem">'+a.text+"</li>"});this.arrayOptions=
e;this.shadowList.html('<ul role="list" class="'+(this.datalist.className||"")+" "+this.datalist.id+'-shadowdom">'+f.join("\n")+"</ul>");b.fn.bgIframe&&l&&this.shadowList.bgIframe();(a||this.isListVisible)&&this.showHideOptions()},showHideOptions:function(){var a=b.prop(this.input,"value").toLowerCase();if(!(a===this.lastUpdatedValue||this.lastUnfoundValue&&a.indexOf(this.lastUnfoundValue)===0)){this.lastUpdatedValue=a;var f=!1,d=b("li",this.shadowList);a?this.arrayOptions.forEach(function(e,c){if(!("lowerText"in
e))e.lowerText=e.text.toLowerCase(),e.lowerValue=e.value.toLowerCase();e.lowerText.indexOf(a)!==-1||e.lowerValue.indexOf(a)!==-1?(b(d[c]).removeClass("hidden-item"),f=!0):b(d[c]).addClass("hidden-item")}):(d.removeClass("hidden-item"),f=!0);(this.hasViewableData=f)?this.showList():(this.lastUnfoundValue=a,this.hideList())}},showList:function(){if(this.isListVisible)return!1;this.needsUpdate&&this.updateListOptions();this.showHideOptions();if(!this.hasViewableData)return!1;var a=this,c=b(this.input).offset();
c.top+=b(this.input).outerHeight();c.width=b(this.input).outerWidth()-(parseInt(this.shadowList.css("borderLeftWidth"),10)||0)-(parseInt(this.shadowList.css("borderRightWidth"),10)||0);l&&(this.shadowList.css("height","auto"),this.shadowList.height()>250&&this.shadowList.css("height",220));this.shadowList.css(c).addClass("datalist-visible");this.isListVisible=!0;b(h).bind("mousedown.datalist"+this.id+" focusin.datalist"+this.id,function(d){d.target===a.input||a.shadowList[0]===d.target||b.contains(a.shadowList[0],
d.target)?(clearTimeout(a.hideTimer),setTimeout(function(){clearTimeout(a.hideTimer)},0)):a.timedHide()});return!0},hideList:function(){if(!this.isListVisible)return!1;this.shadowList.removeClass("datalist-visible list-item-active").scrollTop(0).find("li.active-item").removeClass("active-item");this.index=-1;this.isListVisible=!1;b(this.input).removeAttr("aria-activedescendant");b(h).unbind(".datalist"+this.id);return!0},scrollIntoView:function(a){var c=b("> ul",this.shadowList),d=a.position();d.top-=
(parseInt(c.css("paddingTop"),10)||0)+(parseInt(c.css("marginTop"),10)||0)+(parseInt(c.css("borderTopWidth"),10)||0);d.top<0?this.shadowList.scrollTop(this.shadowList.scrollTop()+d.top-2):(d.top+=a.outerHeight(),a=this.shadowList.height(),d.top>a&&this.shadowList.scrollTop(this.shadowList.scrollTop()+(d.top-a)+2))},markItem:function(a,c,d){d=d||b("li:not(.hidden-item)",this.shadowList);if(d.length)a<0?a=d.length-1:a>=d.length&&(a=0),d.removeClass("active-item"),this.shadowList.addClass("list-item-active"),
d=d.filter(":eq("+a+")").addClass("active-item"),c&&(b.prop(this.input,"value",d.attr("data-value")),b.attr(this.input,"aria-activedescendant",b.webshims.getID(d)),b(this.input).triggerHandler("updateInput"),this.scrollIntoView(d)),this.index=a}};(function(){c.defineNodeNameProperties("input",{list:{attr:{get:function(){var a=c.contentAttr(this,"list");return a==null?j:a},set:function(a){c.contentAttr(this,"list",a);c.objectCreate(p,j,{input:this,id:a,datalist:b.prop(this,"list")})}},initAttr:!0,
reflect:!0,propType:"element",propNodeName:"datalist"},selectedOption:{prop:{writeable:!1,get:function(){var a=b.prop(this,"list"),c=null,d;if(!a)return c;d=b.attr(this,"value");if(!d)return c;a=b.prop(a,"options");if(!a.length)return c;b.each(a,function(a,g){if(d==b.prop(g,"value"))return c=g,!1});return c}}},autocomplete:{attr:{get:function(){var a=b.data(this,"datalistWidget");return a?a._autocomplete:"autocomplete"in this?this.autocomplete:this.getAttribute("autocomplete")},set:function(a){var c=
b.data(this,"datalistWidget");c?(c._autocomplete=a,a=="off"&&c.hideList()):"autocomplete"in this?this.autocomplete=a:this.setAttribute("autocomplete",a)}}}});c.defineNodeNameProperty("datalist","options",{prop:{writeable:!1,get:function(){var a=b("select",this);return a[0]?a[0].options:[]}}});c.addReady(function(a,c){c.filter("select, option").each(function(){var a=this.parentNode,c=b.nodeName(a,"datalist");if(a&&!c)a=a.parentNode,c=b.nodeName(a,"datalist");a&&c&&b(a).triggerHandler("updateDatalist")})})})()}})();
c.modules["forms-ext"].src=="form-datalist"?c.isReady("forms-ext",!0):setTimeout(function(){c.isReady("forms-ext")||(c.warn("setting forms-ext ready from datalist"),c.isReady("forms-ext",!0))},9)});
